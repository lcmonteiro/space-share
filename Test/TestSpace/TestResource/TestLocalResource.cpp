/**
 * ------------------------------------------------------------------------------------------------
 * File:   TestLocalResource.cpp
 * Author: Luis Monteiro
 *
 * Created on January  2, 2019, 10:21 AM
 * ------------------------------------------------------------------------------------------------
 */
#include <gtest/gtest.h>
/**
 * std
 */
#include <future>
/**
 * space
 */
#include "SResourceMonitor.h"
#include "SLocalResource.h"
#include "SRandom.h"
#include "STask.h"
/**
 * ------------------------------------------------------------------------------------------------
 * link test
 * ------------------------------------------------------------------------------------------------
 */
TEST(SLocalResource, Create)
{
    auto rem_c = Message::SLocalResource();
}
/**
 * ------------------------------------------------------------------------------------------------
 * link test
 * ------------------------------------------------------------------------------------------------
 */
TEST(SLocalResource, OneWay)
{
    STask::Enable();
    // definitions ---------------------------------------
    typedef SResourceMonitor<> ResourceMonitor;

    // variables --------------------------------------------------------------
    Message::SLocalResource rem_c;
    Message::SLocalResource rem_s;
    
    // settings ---------------------------------------------------------------
    auto size   = 100;
    auto addr   = SRandom::String(8);

    // prepare ----------------------------------------------------------------
    auto in     = SRandom::Frame(size);
    auto out    = IFrame(size);
    
    // bind -------------------------------------------------------------------
    rem_s.Bind(addr);

    // link & send ------------------------------------------------------------ 
    rem_c.Link(addr).Write(in);

    // wait -------------------------------------------------------------------
    ResourceMonitor(&rem_s).Wait(std::chrono::milliseconds(100));

    // read -------------------------------------------------------------------
    EXPECT_EQ(rem_s.Fill(out).Good(), true);

    // test data --------------------------------------------------------------
    EXPECT_EQ(in, out);
}
/**
 * ------------------------------------------------------------------------------------------------
 * End
 * ------------------------------------------------------------------------------------------------
 */